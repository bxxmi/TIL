# 03. this

📚 코어 자바스크립트 책을 읽고 요약 정리한 문서입니다.

* [this](#this)
  - [전역 공간에서의 this](#전역-공간에서의-this)
  - [메서드 내부에서의 this](#메서드-내부에서의-this)
  - [함수 내부에서의 this](#함수-내부에서의-this)
  - [콜백 함수 내부에서의 this](#콜백-함수-내부에서의-this)
  - [생성자 함수 내부에서의 this](#생성자-함수-내부에서의-this)

## this

this는 함수와 객체(메서드)의 구분이 느슨한 자바스크립트에서 이 둘을 구분하는 유일한 기능이다.
자바스크립트에서 this는 기본적으로 실행 컨텍스트가 생성될 때 함께 결정된다.
이때, 실행 컨텍스트는 함수가 호출될 때 생성되는데 바꿔 말하면 this는 **함수를 호출할 때 결정된다**라고 할 수 있다.

### 전역 공간에서의 this

전역 공간에서의 this는 **전역 객체**를 가리킨다. 전역 컨텍스트를 생성하는 주체가 바로 전역 객체이기 때문이다. 브라우저 환경에서 전역 객체는 `window`, Node.js 환경에서는 `global`이다.

### 메서드 내부에서의 this

메서드 내부에서의 this는 **호출한 주체에 대한 정보**가 담긴다. 메서드는 자신을 호출한 대상 객체에 관한 동작을 수행하는데 이때, 어떤 함수를 객체의 프로퍼티에 할당한다고 해서 무조건 메서드가 되는 것이 아니라 객체의 메서드로서 호출할 경우에만 메서드로 동작하고,
그렇지 않으면 함수로 동작한다. 이것을 구분하는 것은 간단하다. **함수 앞에 점(.)이 있는지 없는지에 따라 구분된다.**

```js
var func = function (x) {
  console.log(this, x);
}
func(1);

var obj = {
  method: func
};
obj.method(2);
```

위 예제의 4번째 줄을 보면 앞에 점이 없으니 함수로서 호출한 것이고, 마지막 9번째 줄은 점이 있으니 메서드로서 호출한 것이다. 어떤 함수를 메서드로서 호출하는 경우 
호출 주체는 바로 함수명(프로퍼티명) 앞의 객체이다. **즉, 마지막 점 앞에 명시된 객체가 곧 this인 셈이다.**

> **💡 메서드 내부 함수에서의 this**
> 
> 메서드 내부 함수는 **함수로 호출되었다는 이유로 호출 주체가 없어서 자동으로 전역 객체를 가리키게 되는데** 이것보다 호출 당시 주변 환경의 this를 그대로 상속받아 사용하는 것이 좋을 것이다.
> 이것이 훨씬 자연스럽고 스코프 체인과의 일관성을 지키는 방식이다. ES5에서는 **변수를 활용**해서 상위 스코프의 this를 저장하고 내부함수에서 활용하며 this를 우회한다.
> ES6에서는 this를 바인딩하지 않는 **화살표 함수를 도입했다.**

### 함수 내부에서의 this

함수를 함수로서 호출하는 경우 this가 지정되지 않는다. 함수로서 호출하는 것은 호출 주체를 명시하지 않고 개발자가 코드에 직접 관여해서 실행한 것이기 때문에 호출 주체의 정보를 알 수 없는 것이다.
따라서 함수에서의 this는 전역 객체를 가리킨다.

### 콜백 함수 내부에서의 this

콜백 함수도 함수이기 때문에 기본적으로 this는 전역 객체를 참조한다. 하지만 제어권을 받은 함수에서 콜백 함수에 별도로 this가 될 대상을 지정한 경우에는 그 대상을 참조하게 된다.
즉, 콜백 함수의 제어권을 가지는 함수(메서드)가 콜백 함수에서의 this를 무엇으로 할지 결정하고 특별히 지정하지 않은 경우 전역 객체를 바라본다.

### 생성자 함수 내부에서의 this

어떤 함수가 생성자 함수로서 호출된 경우 내부에서의 this는 곧 새로 만들 구체적인 인스턴스 자신이 된다.
